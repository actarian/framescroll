!function(){"use strict";Element.prototype.hasClass=function(e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(this.className)},Element.prototype.addClass=function(e){this.hasClass(e)||(this.className=this.className?this.className+" "+e:e)},Element.prototype.removeClass=function(e){this.hasClass(e)&&(this.className=this.className.split(e).join("").replace(/\s\s+/g," "))},window.getMouse=function(e){var t=0;t=e.touches?e.touches[0].pageY:e.clientY;return{x:e.touches?e.touches[0].pageX:e.clientX,y:t}}}(),function(){"use strict";/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream,/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);var r,e=!1,s=30,o=1200,n=o/s,u=15,c={pow:0,end:0,endTime:0,previous:0,direction:0,diff:0,index:0},i=document.querySelector("body"),a=document.querySelector(".page"),t=document.querySelector(".section-overview"),l=document.querySelector(".preload .percent"),d=document.querySelector(".track"),p=document.querySelector(".steps"),m=document.querySelector(".player-time"),v=document.querySelector(".marker-time"),f=Array.prototype.slice.call(document.querySelectorAll("[data-marker]")).map(function(e,t){return e.addEventListener("click",function(){z(t,!0)}),parseFloat(e.getAttribute("data-marker"))});console.log("markers",f);var h={source:{jpg:"img/campagnolo/campagnolo_{0}.jpg",webm:"img/campagnolo.webm",mp4:"img/disc/disc.mp4",check:"img/Chrome_ImF.webm"},video:document.querySelector(".overview-disc .video"),pictures:document.querySelector(".overview-disc .pictures"),captionItems:Array.prototype.slice.call(document.querySelectorAll(".overview-disc .captions-item")),images:[]},g={source:{jpg:"img/campagnolo/campagnolo_{0}.jpg",webm:"img/campagnolo.webm",mp4:"img/rim/rim.mp4",check:"img/Chrome_ImF.webm"},video:document.querySelector(".overview-rim .video"),pictures:document.querySelector(".overview-rim .pictures"),captionItems:Array.prototype.slice.call(document.querySelectorAll(".overview-rim .captions-item")),images:[]},w=null,y=function(){Scrollbar.use(window.OverscrollPlugin);var t=Scrollbar.init(a,{plugins:{overscroll:{}}});return t.addListener(function(e){e.offset,e.limit,a.offsetWidth,a.offsetHeight,b||(0<e.offset.y?i.addClass("submenu"):i.removeClass("submenu"))}),t.onScrollbarShouldScrollTo=function(e){document.querySelector(e.selector)===a&&t.scrollTo(e.x||0,e.y||0,500)},t.pause=function(){},t.resume=function(){return t},t}(),x=!1,b=!1,L=!1;function E(){i.addClass("loading"),x=!0,e?(i.addClass("use-pictures"),h.player=h.pictures,h.player.currentTime=0,h.player.duration=n,h.player.play=h.player.pause=function(){},h.player.setTime=function(){var e=Math.max(1,Math.min(o,Math.round(h.player.currentTime*s)));h.player.index!==e&&(h.player.index=e,h.player.src=h.images[e])},g.player=g.pictures,g.player.currentTime=0,g.player.duration=n,g.player.play=g.player.pause=function(){},g.player.setTime=function(){var e=Math.max(1,Math.min(o,Math.round(g.player.currentTime*s)));g.player.index!==e&&(g.player.index=e,g.player.src=g.images[e])},function(){var n=o,r=0,e=0,i=[];function a(){for(;i.length<u&&e<n;)i.push(!0),t(++e)}function t(o){var e=new XMLHttpRequest;e.open("GET",w.source.jpg.split("{0}").join(o),!0),e.responseType="blob",e.onload=function(){if(200===this.status){var e=this.response,t=URL.createObjectURL(e);images[o]=t,r++,i.shift(),M(r,n),r===n?(w.player.setTime(),q()):a()}},e.onerror=function(e){console.log("preload.error",e)},e.send()}a()}()):(i.addClass("use-video"),h.player=h.video,h.player.setTime=function(){},g.player=g.video,g.player.setTime=function(){},S(h,function(){S(g,function(){A()})}))}function M(e,t){var o=parseInt(100*(e/t));l&&l.setAttribute("style","width:"+o+"%;")}function A(){var e=w.video.play();void 0!==e?e.then(function(){q()}).catch(function(e){console.log("video.error",e,w.video.error)}):q()}function S(o,n){var e=new XMLHttpRequest;e.open("GET",o.source.mp4,!0),e.responseType="blob",e.onprogress=function(e){M(e.loaded,e.total)},e.onload=function(){if(200===this.status){var e=this.response,t=URL.createObjectURL(e);o.video.addEventListener("progress",function(e){console.log("video.progress",e,o.video.duration)},!1),o.video.addEventListener("error",function(e){console.log("video.error",e,o.video.error)}),o.video.autoplay=!0,o.video.mute=!0,o.video.src=t,n&&n()}},e.onerror=function(e){console.log("preload.error",e)},e.send()}function q(){b=!(x=!1),i.removeClass("loading"),i.addClass("loaded"),i.addClass("submenu"),c.pow=c.end=0,0,r=null,w.video.pause(),p&&function(){for(var e=0;e<f.length;e++){var t='<div class="step" style="top:'+(f[e]/n*100).toFixed(3)+'%"></div>';p.innerHTML+=t}}(),function(){d&&d.addEventListener("mousedown",F,B);t.addEventListener("mousedown",J,B),t.addEventListener("mousemove",U,B),t.addEventListener("wheel",W),window.addEventListener("mouseup",G,B)}(),function(){d&&d.addEventListener("touchstart",F,B);t.addEventListener("touchstart",K,B),t.addEventListener("touchmove",U,B),t.addEventListener("touchend",G,B)}(),window.onscroll=_,window.requestAnimationFrame(j),z(1)}function T(e){if(e.player.duration){if(Y)e.player.pause(),c.pow=c.end,e.player.currentTime=c.pow*e.player.duration,e.player.setTime();else if(c.end!==c.pow){e.player.paused||e.player.pause();var t=c.end-c.pow,o=1/s;if(Math.abs(t*e.player.duration)<o)c.pow=c.end;else{var n=t?t/Math.abs(t):0;c.pow+=o*n/e.player.duration}var r=Math.round(c.pow*e.player.duration/o)*o+1e-5;e.player.currentTime=r,e.player.setTime()}if(m){var i=d.offsetHeight;m.setAttribute("style","top:"+e.player.currentTime/e.player.duration*i+"px;")}a=c.direction,w.captionItems.filter(function(e,t){var o=f[t]-c.pow*w.player.duration;2<Math.abs(o)?e.setAttribute("class","captions-item"):0<a?e.setAttribute("class","captions-item "+(-.1<o?"entering":"exiting")):a<0&&e.setAttribute("class","captions-item "+(o<.1?"entering":"exiting"))})}var a}var C=window.peformance?performance:Date,P=1e3/s,I=0,k=0,H=0;function j(){I=C.now(),P<(H=I-k)&&(k=I-H%P,T(w)),requestAnimationFrame(j)}function F(e){if(!L){if(e.preventDefault(),e.stopImmediatePropagation(),"step"===e.target.getAttribute("class"))z(Array.prototype.slice.call(e.target.parentNode.children).indexOf(e.target));return!1}}function N(e){var t=0;return t=e.touches?e.touches[0].pageY:e.clientY,Math.max(0,Math.min(window.innerHeight,t))}function R(e){var t=!1;return(c.pow<1&&1===e||(!y||y.offset.y<10)&&-1===e)&&(t=!0),t}var X,Y=!1,D=0;function O(e){if(y.offset.y<10){var t=N(e);X=null,r=t,D=c.end||0}}function U(e){if(L)r=X=null;else if(r){var t=N(e);if(X=t,1<Math.abs(r-t)){var o=(r-t)/(3*window.innerHeight);c.end=Math.max(0,Math.min(1,D+o)),Y=!0}if(R(0<t-r?-1:1))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}}function G(e){if(Y){var t=r-X;if(t){var o=t/Math.abs(t),n=c.end*w.player.duration;f.filter(function(e,t){e<n&&n<f[t+1]&&(c.index=t+(0<o?0:1))}),$(o)}}Y=!1,r=null}function W(e){var t=e.deltaY/Math.abs(e.deltaY);if($(t),R(t))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}function _(){if(v){var e=d.offsetHeight;v.setAttribute("style","top : "+c.end*(e-30)+"px;")}}function z(o,e){if(o!==c.index){var t=(o-c.index)/Math.abs(o-c.index),n=f[c.index],r=f[o],i=c.pow*w.player.duration;if((e||i>=Math.min(n,r)&&i<=Math.max(n,r))&&(c.index=o,c.endTime=f[c.index],c.direction=t,c.end=c.endTime/w.player.duration,v)){var a=d.offsetHeight;v.setAttribute("style","top : "+c.end*a+"px;")}console.log("setIndex",o),Array.prototype.slice.call(document.querySelectorAll("[data-marker]")).filter(function(e,t){o===t?e.addClass("active"):e.removeClass("active")})}}function $(e){c.index;z(1===e?Math.min(f.length-1,c.index+1):Math.max(0,c.index-1))}var B=window.PointerEvent?{passive:!1,capture:!0}:void 0;function J(e){!function(){d&&d.removeEventListener("touchstart",F);t.removeEventListener("touchstart",K),t.removeEventListener("touchmove",U),t.removeEventListener("touchend",G)}(),O(e)}function K(e){!function(){d&&d.removeEventListener("mousedown",F);t.removeEventListener("mousedown",J),t.removeEventListener("mousemove",U),window.removeEventListener("mouseup",G)}(),O(e)}var Q,V,Z=Array.prototype.slice.call(document.querySelectorAll("img.svg"));Z=Z.map(function(o){var n=o.getAttribute("class"),e=o.getAttribute("src"),t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="text",t.onload=function(){if(200===this.status){var e=o.parentNode;e.innerHTML=this.responseText;var t=e.querySelector("svg");console.log(t),t.setAttribute("class",n),t.setAttribute("xmlns:a",null)}},t.onerror=function(e){console.log("svg.error",e)},t.send()}),Array.prototype.slice.call(document.querySelectorAll("[scroll-to]")).map(function(r,e){return r.addEventListener("click",function(e){var t=r.getAttribute("href"),o=document.querySelector(t);if(o){var n=o.offsetTop;y.scrollTo(0,n,600,{callback:function(){console.log("ScrollTo.complete",n)}})}return e.preventDefault(),e.stopImmediatePropagation(),!1}),r}),Q=document.querySelector(".overview-logo"),V={x:0,y:0},function e(){Q.setAttribute("style","transform: rotateX("+4*V.y+"deg) rotateY("+20*V.x+"deg);"),requestAnimationFrame(e)}(),window.addEventListener("mousemove",function(e){V.x=e.clientX/window.innerWidth-.5,V.y=e.clientY/window.innerHeight-.5}),function(){var n,r,e=document.querySelector(".overview-switch"),i=document.querySelector(".switch-slider"),a=document.querySelector(".overview-disc"),s=document.querySelector(".overview-rim"),u=a.querySelector(".cover"),c=s.querySelector(".cover"),l=i.offsetWidth,d={x:0,y:0},o={x:0,y:0},p=50;function m(){i.setAttribute("style","transform: translateX("+d.x*l/2+"px)");var e=function(e){e=e/2+.5;var t=100*(e=Math.min(1,Math.max(0,e)));return Math.abs(t-p)<.1?p=t:p+=(t-p)/20,{disc:"polygon(0 0, "+t+"0.01% 0, "+p+"0.01% 100%, 0 100%)",rim:"polygon("+t+"% 0, 100% 0, 100% 100%, "+p+"% 100%)"}}(d.x);a.setAttribute("style","shape-inside: "+e.disc+"; clip-path: "+e.disc+"; -webkit-clip-path: "+e.disc+";"),s.setAttribute("style","shape-inside: "+e.rim+"; clip-path: "+e.rim+"; -webkit-clip-path: "+e.rim+";");var t=1.1-(d.x+1)/2*.1,o=1+(d.x+1)/2*.1,n=20*(d.x<0?Math.abs(d.x):0)+"px",r=20*(0<d.x?Math.abs(d.x):0)+"px";u.setAttribute("style","transform: scale("+t+"); filter: blur("+n+");"),c.setAttribute("style","transform: scale("+o+"); filter: blur("+r+");")}function t(e){if(!x)return L=!0,o.x=d.x,o.y=d.y,n=getMouse(e),b&&(T(h),T(g)),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}function v(e){if(n){r=getMouse(e);var t=o.x+(r.x-n.x)/(l/2);return t=Math.max(-1,Math.min(1,t)),d.x,d.x=t,m(),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}}!function e(){m(),requestAnimationFrame(e)}(),window.addEventListener("mousemove",v);var f=[-1,0,1];function y(e){if(r){n=r=null;var t=f.reduce(function(e,t){return Math.abs(e-d.x)<Math.abs(t-d.x)?e:t}),o=!1;0!==t&&3===f.length&&(f=[-1,1],o=!0),2==f.length&&(w=-1===t?g:h),d.x,TweenLite.to(d,1,{x:t,ease:Elastic.easeOut,onUpdate:m,onComplete:function(){o&&E()}})}L=!1,window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",y),window.removeEventListener("touchmove",v),window.removeEventListener("touchend",y)}e.addEventListener("mousedown",function(e){t(e),window.addEventListener("mousemove",v),window.addEventListener("mouseup",y)}),e.addEventListener("touchstart",function(e){t(e),window.addEventListener("touchmove",v),window.addEventListener("touchend",y)}),window.addEventListener("resize",function(){l=i.offsetWidth,m()})}()}();
//# sourceMappingURL=app.min.js.map
